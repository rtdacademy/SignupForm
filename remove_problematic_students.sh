#!/bin/bash

# Script to remove problematic student nodes from Firebase
# These nodes don't contain @ symbols and are incorrectly formatted

echo "Starting removal of problematic student nodes..."

# Array of all problematic keys to remove
KEYS_TO_REMOVE=(
"s,mustaf"
"3040-8218-3_MAT3792_682a9485-8874-4458-9810-3f3f677f8bff"
"3028-7664-4_MAT3792_39ec70ec-391a-4347-8de9-b8ab4f9e3940"
"3025-5280-7_MAT3792_8c5434c9-df51-4911-aee1-607e9686d537"
"1020-3482-4_MAT3792_d0223d19-310f-4583-b2e2-7f73dce26f7c"
"e"
"3053-2256-2_MAT2792_3e7430e0-4dc4-4ed8-8bac-3798b4034838"
"test-student"
"3037-2968-5_MAT3792_27399b95-f736-44e1-a827-9a5b42be058a"
"3095-8637-8_MAT2793_a32e4cde-6118-4ba2-af98-c857edba67df"
"3025-5815-0_MAT2792_ce81d44b-826a-4dd4-a309-5e0f4016e2cc"
"3027-8500-1_MAT3792_5bee8356-d3bb-48e4-9b79-c49d725e3e9f"
"3031-8210-9_MAT3792_3c47ac3e-6078-4cb7-a9c0-e5d365e8fa1b"
"3129-8689-6_MAT3792_4227fdad-bf37-4d49-8e33-2a1f10308def"
"1269-4193-9_SCN2797_6eaca53f-f27a-439d-9f66-785b8bf92446"
"3026-8071-5_MAT3792_51e37683-757a-4c9c-804a-140d3fa9f4c9"
"3029-7057-9_MAT2792_2dfc3e0c-30da-4be9-a41b-fa886efe50f9"
"3120-2280-9_MAT3792_05ef9b64-b91e-4f0d-98c0-979ae1f467b9"
"3129-9357-9_MAT3792_f513df65-5360-4659-8e62-6eca8074fcc7"
"3034-0623-5_MAT3792_fab46d69-7a47-4641-ba0e-30dc0b9e4dae"
"3034-0633-4_MAT3792_f7240339-39fb-4356-a2b4-8678b473b516"
"3053-5587-7_LDC1515_d26d6a94-b45f-44e2-aae0-27680b6877d9"
"3021-8151-6_MAT3792_60e8af91-6fe3-41af-8f21-a1864637847c"
"1010-4878-3_MAT3792_95d2dcfc-1aac-4904-bc0a-e2e20f5ff575"
"3037-2348-0_MAT3792_46bec6f9-618c-45ce-a7d3-de1f273ed5e1"
"3031-1848-3_MAT2792_157f9d52-05fd-42e9-a75b-cee3e5cf535e"
"chouhan"
"1101-5368-1_MAT3792_f0ae9792-b820-4ae7-8135-5b22cd11e4df"
"3044-0120-1_MAT3211_e2bc6361-de8c-416c-b637-1f92a1cae1bc"
"3036-2924-0_MAT2791_de9a460f-f446-4f23-b704-ccfb48426386"
"3072-3881-6_MAT2792_e8d99348-7683-452a-8cf2-3a51cbdada2d"
"1128-2825-6_MAT3792_44c77b21-6544-408f-bf32-80b541e97f00"
"colten"
"8911-3911-5_MAT3792_92ad2ee1-146e-4ce3-b9f0-df6368f2c98e"
"1281-7711-0_MAT2792_e6f05e84-ff9b-447a-81a8-00612c867163"
"3037-5692-8_SCN2797_bd197fd9-97c2-4747-ad86-292100dba6ff"
"3034-0645-8_MAT3793_f0e4af65-a351-468f-8c36-b7174efec96d"
"6706-0343-0_MAT2792_31eac043-9c50-4f23-a5fb-809f29bb13c3"
"3036-1506-6_MAT3792_5900f8da-9a2d-4cc8-a01b-933a3ffb8d96"
"3032-6459-2_MAT3792_9e464c52-f387-4646-ae5a-4c272e0d261e"
"3122-3121-0_MAT3792_f4ebe42a-916c-4e85-8133-3e8af66a5e9c"
"9110-0196-4_MAT2792_1da8131f-d6c9-4dd9-bfac-a2de205e0789"
"3061-1890-2_SCN2797_b8d4e63c-dc60-496b-8a24-4631665b8e9f"
"3029-6556-1_MAT3792_fe2f1398-f110-490e-b437-5d029f5ddf9c"
"1257-7875-3_MAT3792_b3abf06e-97e4-4523-9a9a-50bffc502995"
"3032-6801-5_MAT2792_e9045769-776e-4b37-8cfd-a62e7ca35552"
"nauman"
"3046-6033-5_SCN2797_b7295420-40c9-4ec8-8ac9-1cd9dd51d493"
"3088-1978-8_MAT2792_fae52aa3-e270-4164-9d62-32ed62bf1846"
"3040-3660-1_MAT3792_f2a5d4ce-6026-4dd6-8ec3-203e0fa51eb0"
"3044-2947-5_MAT2791_6bafe91f-0113-4688-9798-8a3f44ca50bb"
"3032-4901-5_MAT3792_34bcbb4e-7803-4274-bfeb-788f8e66034f"
"3033-3812-3_MAT3792_4313d0f5-0d81-48d0-b737-010581664c90"
"a"
"3023-6532-5_MAT3792_8fd4fe07-799a-416f-b652-7e20fd7c684d"
"1034-5474-0_MAT3792_c378d3d9-5311-4362-9f2c-b278948a84ab"
"1109-6659-5_MAT1791_2d35b496-6236-4ec3-a93a-ee2dce8bfde1"
"3065-1040-5_MAT3792_c6318a51-303a-45f6-9064-89507d0a31bf"
"3067-4615-7_LDC1515_9a838168-5fd5-4241-9c6a-da2ee784ecf6"
"3039-0241-5_MAT3792_a9bf7034-d0c8-41c0-80d8-d805ac9191f9"
"3043-2165-6_SCN2797_3bbd8f3f-4262-48f4-96e8-e3f17eacc8c7"
"3033-3648-1_MAT3792_67362c1f-3325-41f5-9cb9-a003da456c22"
"chime"
"3092-6781-3_MAT3792_adfce60e-e199-4fb2-81a2-fd8dd56019de"
"3026-4206-1_MAT3792_27cba048-4a0e-4623-ac6f-d36a74c4888c"
"3092-8409-9_MAT2792_34296a7f-a273-4c49-ac3d-80f12a2fd82e"
"3052-8906-8_MAT1791_e9a1c47a-1b66-4e4e-8bc3-febdf523e3e1"
"3040-4609-7_MAT2792_19e1e4a5-eb83-4df3-9fd2-edeb3dadb6d8"
"3033-0682-3_MAT3792_d83610f4-5f67-453a-97f6-b736fd000019"
"8001-0445-7_MAT2792_82300aac-521d-487f-bcdc-35fe9560305a"
"9307-0769-0_MAT3792_44131ea2-50df-4be5-9a1e-906cfeeaaca1"
"3037-4622-6_MAT3791_5d3afa6a-f644-44fa-983e-c6b6b77cb3f6"
"3046-3986-7_MAT2792_8fe84b06-8ae8-4b7e-a058-965e54ab887e"
"3035-8448-6_MAT2792_2fda88f1-7800-469a-9fd6-a2e7d1cb393c"
"3029-5492-0_MAT2792_8d8e42cd-bad4-4a09-a077-5225e7859a2c"
"prathyunkarganeshsankar"
"3156-4049-0_MAT3211_851ef083-b899-45cb-b86b-44ee083dab3d"
"3064-6244-1_MAT3792_45f01e65-9f19-48bd-b7c0-6e8cd43f0ace"
"3025-8543-5_MAT3792_b22125a9-0c79-4547-b186-ed8d9d0f312f"
"3047-5205-8_MAT2792_46384962-fb7e-42a7-8797-d80a83f9d037"
"blap"
"3081-0267-2_MAT2792_44282808-d386-4095-8efc-54b84f040e13"
"3038-0693-9_MAT2792_300283ea-2898-40a4-b293-33be4f106b72"
"3058-9070-9_MAT3792_f25751e1-2405-4199-8e76-14acd6d73b2d"
"osville"
"1108-8278-4_MAT3792_d65bac9d-4b5c-40a5-b4b0-226263d5e297"
"3034-3660-4_MAT3792_055e430a-0ec4-43fd-8802-12f4c115bedc"
"3034-0145-9_MAT3792_17300938-873c-4b48-a50a-560636d94938"
"1255-1714-4_MAT3792_60c475ac-6dbb-4efe-8f31-5edb6a0bfe87"
"3047-9511-5_LDC1515_32df1441-e6ed-400f-961d-76949e31b3a7"
"3027-2478-6_MAT1791_82bcd8d6-0251-41d9-8d65-4ad1a81c17d0"
"michelle"
"3038-4079-7_MAT3792_358d81db-fe94-455a-a411-1f06cb279263"
"3045-8607-6_MAT2792_d0090c58-f98f-4262-b334-72b3aabfc4dd"
"3029-1691-1_MAT3792_8589bb2b-979b-4fbc-aa12-b9cf26d3d031"
"3024-0527-9_MAT2792_b3d5a665-cdc9-4f13-97fe-859836122ac3"
"3129-3642-0_MAT3792_3a64d465-d8d3-4f29-8a23-1138013658db"
"kara"
"3052-4869-2_LDC1515_f32eddc2-7973-48d0-a077-88b8e1fc2c9c"
"3035-7410-7_MAT3211_8467f839-f776-40fe-b7db-a90bbb413d74"
"7811-0551-5_MAT3792_33c80d7f-c477-48c6-8086-9c221fa97d0d"
"3036-6199-5_MAT3792_c88ae70f-54b9-4c81-b1fe-903c8b2d6f40"
"3054-2456-6_MAT2792_ed57f3bf-2a9e-42c5-af7f-74dcd4e7be1d"
"3070-3549-3_LDC1515_8e3e371d-691b-452a-91e9-89a5546645a9"
"3026-4599-9_MAT3792_36e9bc9f-8ca4-4eda-9a62-defa088a81f3"
"3031-3591-7_MAT3792_8213ec6d-5a2e-44df-9772-1c809a0340ab"
"3036-9815-3_MAT3791_db10c9eb-0f63-4293-83b8-56bbe03d29ba"
"3033-4984-9_MAT2792_0a93a466-01a9-4409-95e0-f5b17934c5a5"
"8508-1306-4_MAT2792_f1d452a4-fbeb-4bb6-ae8a-0395b034d06a"
"1270-0614-6_SCN2797_6533ee6a-dce2-45fc-9695-6b235c0cfb1b"
"3093-1833-5_MAT2791_6eb809fa-ecaa-4468-a2bd-9345576a3c5b"
"jgfkld;s"
"3029-4373-3_MAT2792_bead243f-e730-4a91-983e-a2a05397aec6"
"3044-9287-9_MAT3792_e18109ec-d0d7-4957-80a3-d06084fa49b1"
"3030-0734-8_MAT3792_2a912f85-a0fc-4b96-9e06-996aa66e1b4b"
"3092-7467-8_MAT3792_af823c3f-aade-41c5-a42a-d7a0034bbe69"
"3033-9761-6_MAT3792_813a852a-6d8e-4e88-a112-416af0deb8fd"
"3046-4863-7_MAT2792_74614a7e-6779-4a69-a704-f6e0299f9c72"
"3033-9065-2_MAT2792_f4f62dcd-03e7-4712-bc31-90b7d1c0226c"
"3048-6216-2_MAT3792_23837401-edac-4383-9507-2cb8b5fe6194"
"3048-5028-2_LDC1515_1a38095a-4335-4930-99cd-81f9d3dc9b9d"
"3046-4895-9_MAT2792_98d68b22-d6c8-4fcd-81d5-4c8f846dfe72"
"3044-5391-3_SCN2797_12a69e09-c4cf-46be-adae-1ac239695f87"
"3024-4247-0_MAT3792_54bf4b84-4bea-40ec-96c9-dbe003172d1e"
"3033-8740-1_MAT3792_6dd716b9-25b7-4369-9a89-87db036d44c7"
"3030-9985-7_MAT2792_a555bccd-d3fa-4969-af21-04fceb33c90a"
"3043-9314-3_MAT2791_28ed7c6c-f9f4-44b0-b4fa-2c4cb7176120"
"3035-3021-6_MAT2792_31e9e469-dc4b-428d-a964-e4574d7fcabb"
"3031-5115-3_MAT3792_4d80a519-1a1d-436e-9c1b-107b987a642d"
"stine"
"3034-1735-6_MAT3792_7407cc41-654e-4d22-b25c-95c0cfdccc61"
"3031-6124-4_MAT3792_0976cf2e-ef6a-4311-99f6-0b95b8c106c8"
"3081-7157-8_MAT2792_28d46ca8-cb1e-40db-b694-6aee02a13aa5"
"3052-3460-1_MAT2792_776d7745-34bd-4335-a85a-87cea47f870c"
"3043-9226-9_SCN2797_ef19d56d-c967-4be8-9a39-f9dcadf423bf"
"3055-7140-8_MAT3792_154480eb-ec6a-4450-957e-fa47ef140c3d"
"3036-7046-7_MAT3792_86f8c8f2-ca10-46c8-ba21-83dcf3e833bf"
"3034-3138-1_MAT3792_b9f3a606-0967-432d-bbcf-06e96bbe0aff"
"s,mohamed133"
"306953704"
"3043-1086-5_MAT3792_f19c1d2b-9600-4021-8eb2-057322546a4b"
"3040-9267-9_MAT3792_7903141f-3713-4880-91ba-a011b87e28b0"
"3020-9139-2_MAT3792_9f9fa8d0-f6b2-415d-aabb-ea147a723d38"
"3055-4952-9_MAT3792_daf20e19-82cb-47bc-b115-d13424d45c7c"
"3051-6337-0_LDC1515_6f727abf-b798-4803-8682-a08a559188eb"
"none"
"3020-2941-8_MAT2792_68f773fb-e58b-4f90-9605-5c17881b6993"
"3033-4583-9_MAT3792_b1f88c20-3e0f-4c84-b109-8adf563cefec"
"3037-1607-0_MAT3792_91f5a714-1cb6-4a12-9a9f-dc8ff02f031c"
"notifications"
"3029-8866-2_MAT2792_dcf12aaa-4796-4663-ace8-0c2e1938b95c"
"3063-2453-4_MAT3792_679b805c-abbd-42be-9dbb-45a0be6e05c3"
"3034-7066-0_MAT2792_1b8a4901-6d5e-49a1-9711-613de7e161f2"
"3026-7679-6_MAT3792_4d79ffc8-f5e6-4ed9-be8c-bb6f0dc74969"
"1321-4280-3_MAT3792_beeb8b7f-907c-4a88-9fd3-04871bb56ccf"
"3050-5282-1_MAT2791_dc9e9137-0b77-4108-a94a-eaee7495aab1"
"3043-3289-3_MAT2792_0b5ae948-817a-4f84-8239-d9eaf15bc342"
"3145-1624-6_MAT3791_5e03fe92-8239-43fe-a588-621d9c46147a"
"3040-5496-8_SCN2797_24d89eac-2853-4a05-81c1-dd4e4e72e182"
"3032-6637-3_MAT3792_3197067d-2a41-4487-ba03-e3185c3ec2b5"
"3044-5353-3_MAT2792_0113ef6d-8621-4470-9b66-d3376c5b2c88"
"3078-5322-6_SCN2797_4b8a2ac6-e484-43d5-ba71-c5ec5c323abf"
"3073-7879-4_MAT3792_5db63dff-ef2d-4df1-b853-ba37c9246f21"
"3026-4206-1_MAT3792_70ec0666-e003-41a6-a804-09824d43aeee"
"3033-7835-0_MAT2793_12475f9b-d69a-4684-95cc-738b2c1c0ce9"
"3036-8609-1_MAT3792_68b54ec1-d87f-4b3e-af3a-a9fb62caa117"
"3044-6269-0_SCN2797_f1f23aae-3ef6-47a9-a836-2fb2f4ed2646"
)

TOTAL_KEYS=${#KEYS_TO_REMOVE[@]}
SUCCESS_COUNT=0
FAILURE_COUNT=0

echo "Found ${TOTAL_KEYS} problematic keys to remove"

# Function to safely remove a student node
remove_student_node() {
    local key="$1"
    local index="$2"
    
    echo "[$index/$TOTAL_KEYS] Removing: $key"
    
    if firebase database:remove "/students/$key" --force; then
        echo "✓ Successfully removed: $key"
        ((SUCCESS_COUNT++))
    else
        echo "✗ Failed to remove: $key"
        ((FAILURE_COUNT++))
    fi
}

# Remove each problematic student node
for i in "${!KEYS_TO_REMOVE[@]}"; do
    key="${KEYS_TO_REMOVE[$i]}"
    index=$((i + 1))
    remove_student_node "$key" "$index"
    
    # Add a small delay to avoid overwhelming the database
    sleep 0.1
done

echo ""
echo "Cleanup completed!"
echo "Successfully removed: $SUCCESS_COUNT nodes"
echo "Failed to remove: $FAILURE_COUNT nodes"
echo "Total processed: $TOTAL_KEYS nodes"

if [ $FAILURE_COUNT -eq 0 ]; then
    echo "🎉 All problematic student nodes have been successfully removed!"
else
    echo "⚠️  Some nodes failed to be removed. Please check the output above for details."
fi